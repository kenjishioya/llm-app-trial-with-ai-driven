# 🧪 Task 3-4A 手動統合テスト手順書
**対象**: Azure AI Search統合RAG機能
**実施日**: 2025-06-12
**目的**: ユニットテストでスキップした統合機能の手動検証

---

## 📋 テスト概要

**テスト範囲**:
- RAGサービスとAzure AI Search統合
- GraphQL API経由でのドキュメント検索
- セッション管理とメッセージ保存
- ストリーミング応答機能
- エラーハンドリング

**前提条件**:
- Azure AI Search インデックスに29件のテストドキュメントが投入済み
- フロントエンド・バックエンドサーバーが起動済み
- `.env`ファイルに適切なAzure設定が記載済み

---

## 🎯 テストケース

### Test Case 1: 基本RAG検索機能
**目的**: Azure AI Search経由でのドキュメント検索とRAG回答生成

**入力値**:
```
質問: "Pythonの非同期プログラミングについて教えてください"
セッション: 新規作成
deepResearch: false
```

**期待結果**:
- ✅ セッションが新規作成される
- ✅ Azure AI Searchでドキュメント検索が実行される
- ✅ 検索結果に基づいたRAG回答が生成される
- ✅ 回答にPython非同期プログラミングの内容が含まれる
- ✅ 引用情報（citations）が表示される
- ✅ 関連性スコアが0.5以上のドキュメントが引用される
- ✅ メッセージがデータベースに保存される

**検証方法**:
1. ブラウザで http://localhost:3000/chat にアクセス
2. 上記質問を入力して送信
3. ストリーミング応答を確認
4. 引用リンクをクリックして内容確認

---

### Test Case 2: セッション履歴管理
**目的**: セッション作成・復元・削除機能の確認

**入力値**:
```
操作1: 新規セッション作成 → "TypeScriptの型システムについて"
操作2: サイドバーでセッション一覧確認
操作3: 別の新規セッション作成 → "Reactのフックについて"
操作4: 最初のセッションに戻る
操作5: セッション削除
```

**期待結果**:
- ✅ 複数セッションが独立して管理される
- ✅ サイドバーにセッション一覧が表示される
- ✅ セッション切り替えで過去の会話が復元される
- ✅ セッション削除が正常に動作する
- ✅ 削除後にセッション一覧から消える

---

### Test Case 3: ストリーミング応答機能
**目的**: SSE経由でのリアルタイム応答表示

**入力値**:
```
質問: "Azure AI Searchの特徴とメリットを詳しく説明してください"
```

**期待結果**:
- ✅ 質問送信後、即座にローディング状態表示
- ✅ SSEストリームで段階的にテキストが表示される
- ✅ 応答完了後にローディング状態が解除される
- ✅ 最終的な回答が完全に表示される
- ✅ ストリーム中断・再接続が適切に処理される

---

### Test Case 4: 検索品質・関連性確認
**目的**: Azure AI Searchの検索精度とRAG回答品質

**入力値**:
```
質問1: "FastAPIでGraphQLを使う方法"
質問2: "データベースマイグレーションのベストプラクティス"
質問3: "存在しない技術について" (例: "QuantumScript言語")
```

**期待結果**:
- ✅ 質問1: FastAPI + GraphQL関連ドキュメントが検索される
- ✅ 質問2: データベース・マイグレーション関連が検索される
- ✅ 質問3: 関連ドキュメントが見つからない場合の適切な応答
- ✅ 各回答に適切な引用情報が含まれる
- ✅ 関連性スコアが妥当な範囲（0.3-1.0）

---

### Test Case 5: エラーハンドリング
**目的**: 異常系での適切なエラー処理

**入力値**:
```
操作1: 空の質問を送信
操作2: 非常に長い質問（1000文字以上）を送信
操作3: 特殊文字・絵文字を含む質問
操作4: ネットワーク切断シミュレーション
```

**期待結果**:
- ✅ 空の質問: 適切なバリデーションエラー表示
- ✅ 長い質問: 適切に処理されるか、制限エラー表示
- ✅ 特殊文字: 正常に処理される
- ✅ ネットワーク切断: 再接続・エラー回復処理

---

## 🔧 テスト実行手順

### 1. 環境準備
```bash
# バックエンド起動
cd backend
docker-compose up -d postgres
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000

# フロントエンド起動（別ターミナル）
cd frontend
npm run dev
```

### 2. 事前確認
```bash
# バックエンドヘルスチェック
curl http://localhost:8000/health

# GraphQLスキーマ確認
curl -X POST http://localhost:8000/graphql \
  -H "Content-Type: application/json" \
  -d '{"query":"query{__schema{types{name}}}"}'

# フロントエンドアクセス確認
open http://localhost:3000/chat
```

### 3. テスト実行
各テストケースを順番に実行し、結果を記録

### 4. 結果記録
- ✅ 成功: 期待通りの動作
- ⚠️ 部分成功: 一部機能に問題
- ❌ 失敗: 期待と異なる動作
- 🐛 バグ発見: 修正が必要な問題

---

## 📊 テスト結果記録表

| テストケース | 実行日時 | 結果 | 備考 |
|------------|---------|------|------|
| Test Case 1: 基本RAG検索 | 2025-06-12 13:34 | ✅ 成功 | Azure AI Search統合、引用情報、DB保存全て正常動作 |
| Test Case 2: セッション履歴 | | | |
| Test Case 3: ストリーミング | | | |
| Test Case 4: 検索品質 | | | |
| Test Case 5: エラーハンドリング | | | |

---

## 🎯 合格基準

**最低合格ライン**:
- Test Case 1-3: 全て✅成功
- Test Case 4: 3問中2問以上で適切な回答
- Test Case 5: 4操作中3操作以上で適切なエラー処理

**理想的な結果**:
- 全テストケース✅成功
- 応答時間: 平均30秒以内
- 検索関連性スコア: 平均0.5以上
- エラー回復: 全て適切に処理

---

## 🚀 テスト後のアクション

**成功時**:
- Phase 3-4A 手動統合テスト完了
- Task 3-4A-2, 3-4A-3 の代替テスト完了
- Phase 3 完了判定

**問題発見時**:
- 問題の詳細記録
- 修正優先度の判定
- 必要に応じて修正実装

---

*作成日: 2025-06-12*
*テスト実施者: [実施者名]*
*テスト環境: ローカル開発環境*
